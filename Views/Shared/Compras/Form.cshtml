@model Sistema.Models.Compras

@{
    var disabled = Convert.ToBoolean(ViewBag.disabledForm);
    var pageType = Convert.ToString(ViewBag.pageType);
    var tam = pageType == "create" ? 8 : 7;
}

@if (pageType != "create")
{
    <div class="row g-3">
        <div class="col-md-3">
            @Html.LabelFor(e => e.flSituacao, new { @class = "form-label" })
            @Html.TextBoxFor(model => model.flSituacao, new { @class = "form-control", autofocus = "autofocus", disabled = "disabled" })
        </div>
    </div>
}

<div class="CabecalhoNota">
    <div class="col-md-3">
        @Html.LabelFor(e => e.nrModelo, new { @class = "form-label" })
        @(disabled ?
            @Html.TextBoxFor(model => model.nrModelo, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
            @Html.TextBoxFor(model => model.nrModelo, new { @class = "form-control", maxlength = "150", @placeholder = "" })
            )
        @Html.ValidationMessageFor(model => model.nrModelo, null, new { @class = "help-block" })
    </div>

    <div class="col-md-3">
        @Html.LabelFor(e => e.nrSerie, new { @class = "form-label" })
        @(disabled ?
            @Html.TextBoxFor(model => model.nrSerie, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
            @Html.TextBoxFor(model => model.nrSerie, new { @class = "form-control", maxlength = "150", @placeholder = "" })
            )
        @Html.ValidationMessageFor(model => model.nrSerie, null, new { @class = "help-block" })
    </div>

    <div class="col-md-3">
        @Html.LabelFor(e => e.nrNota, new { @class = "form-label" })
        @(disabled ?
            @Html.TextBoxFor(model => model.nrNota, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
            @Html.TextBoxFor(model => model.nrNota, new { @class = "form-control", maxlength = "150", @placeholder = "" })
            )
        @Html.ValidationMessageFor(model => model.nrNota, null, new { @class = "help-block" })
    </div>

    <div class="col-md-3">
        @Html.LabelFor(e => e.idFornecedor, new { @class = "form-label" })
        <div class="input-group mb-3">
            @(disabled ?
                @Html.DropDownListFor(model => model.idFornecedor, Model.ListFornecedores, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
                @Html.DropDownListFor(model => model.idFornecedor, Model.ListFornecedores, new { @class = "form-control" })
                )
            @if (pageType == "Create" || pageType == "Edit")
            {
                <button class="btn btn-outline-secondary" type="button" id="btnAbreModalFornecedor" data-bs-toggle="modal" data-bs-target="#modalFornecedor"><i class="fas fa-search"></i></button>
            }
        </div>
        @Html.ValidationMessageFor(model => model.idFornecedor, null, new { @class = "help-block" })
    </div>
</div>

<br />
<hr />
<br />

<div class="Corpo row g-3" style="display: none">
    <div class="col-md-4">
        @Html.LabelFor(e => e.dtEmissao, new { @class = "form-label" })
        @(disabled ?
            @Html.TextBoxFor(model => model.dtEmissao, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
            @Html.TextBoxFor(model => model.dtEmissao, "{0:dd/MM/yyyy}", new { @class = "form-control", maxlength = "150", @placeholder = "" })
            )
        @Html.ValidationMessageFor(model => model.dtEmissao, null, new { @class = "help-block" })
    </div>

    <div class="col-md-4">
        @Html.LabelFor(e => e.dtCadastro, new { @class = "form-label" })
        @(disabled ?
            @Html.TextBoxFor(model => model.dtCadastro, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
            @Html.TextBoxFor(model => model.dtCadastro, "{0:dd/MM/yyyy}", new { @class = "form-control", maxlength = "150", @placeholder = "" })
            )
        @Html.ValidationMessageFor(model => model.dtCadastro, null, new { @class = "help-block" })
    </div>

    <div class="col-md-4">
        <div class="col-md-3">
            @Html.LabelFor(e => e.chaveNFe, new { @class = "form-label" })
            @(disabled ?
                @Html.TextBoxFor(model => model.chaveNFe, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
                @Html.TextBoxFor(model => model.chaveNFe, new { @class = "form-control", maxlength = "150", @placeholder = "" })
                )
            @Html.ValidationMessageFor(model => model.chaveNFe, null, new { @class = "help-block" })
        </div>
    </div>
</div>

<div class="bs-callout bs-callout-primary row g-3">
    <h4> Produtos</h4>
    <hr />

    <div id="divAddProduto">
        <div class="form-row">
            @Html.LabelFor(e => e.idProduto, new { @class = "form-label" })
            <div class="input-group mb-3">
                @(disabled ?
                    @Html.DropDownListFor(model => model.dsProduto, Model.ListProdutos, new { @class = "form-control", autofocus = "autofocus", @disabled = "disabled" }) :
                    @Html.DropDownListFor(model => model.dsProduto, Model.ListProdutos, new { @class = "form-control" })
                    )
                @if (pageType == "Create" || pageType == "Edit")
                {
                    <button class="btn btn-outline-secondary" type="button" id="btnAbreModalProduto" data-bs-toggle="modal" data-bs-target="#modalProduto"><i class="fas fa-search"></i></button>
                }
            </div>

            <div style="margin-block:-1px">
                <button id="addProduto" type="button" class="btn btn-success btn-lg" style="margin-top:35px; font-size:14px" title="Adicionar"><b>Adicionar </b> <i class="fa fa-plus"></i></button>
            </div>
        </div>
    </div>

    @Html.HiddenFor(model => model.jsProdutos)
    <table id="tblProduto" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                @if (pageType == "create")
                {
                    <th width="5%"></th>
                }
                <th width="5%">Cod</th>
                <th width="40%">Produto</th>
                <th width="10%">Unidade</th>
                <th width="10%">Quant.</th>
                <th width="10%">Vl. compra</th>
                <th width="10%">Desconto</th>
                <th width="10%">Total</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <td id="ftp" colspan="@tam" style="text-align:right"></td>
            </tr>
        </tfoot>
    </table>
</div>